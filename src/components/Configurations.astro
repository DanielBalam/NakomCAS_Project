---
const { selected = "" } = Astro.props;
import Basic from "../components/ConfiguracionComponents/Basic.astro";
import Gaming from "../components/ConfiguracionComponents/Gaming.astro";
---

<div class="w-full flex gap-6 p-6 min-h-screen max-w-6xl mx-auto">
  <!-- Sidebar para seleccionar el formulario -->
  <aside
    id="menu-botones"
    data-selected="{selected}"
    class="flex flex-col gap-6 my-auto"
  >
    <button
      class="p-4 rounded-xl border cursor-pointer h-25 w-25 transition-colors duration-200 boton-formulario"
      data-form="basic"
    >
      <img
        src="../../public/img/Configuracion.png"
        alt="Configuración básica"
        class="opacity-60 transition-opacity duration-200"
      />
    </button>
    <button
      class="p-4 rounded-xl border cursor-pointer h-25 w-25 transition-colors duration-200 hover:bg-gray-200 boton-formulario"
      data-form="gaming"
    >
      <img
        src="../../public/img/Gaming.png"
        alt="Gaming"
        class="opacity-60 transition-opacity duration-200"
      />
    </button>
    <button
      class="p-4 rounded-xl border cursor-pointer h-25 w-25 transition-colors duration-200 hover:bg-gray-200 boton-formulario"
      data-form="monitor"
    >
      <img
        src="../../public/img/Audiovisual.png"
        alt="Audiovisuales"
        class="opacity-60 transition-opacity duration-200"
      />
    </button>
    <button
      class="p-4 rounded-xl border cursor-pointer h-25 w-25 transition-colors duration-200 hover:bg-gray-200 boton-formulario"
      data-form="dev"
    >
      <img
        src="../../public/img/Trabajo.png"
        alt="Trabajo"
        class="opacity-60 transition-opacity duration-200"
      />
    </button>
  </aside>

  <!-- Main Container -->
    <section class="flex-1 bg-white p-10 rounded-2xl shadow mx-10">
        <div id="form-area" data-selected={selected}>
        <!-- Cada formulario se renderiza server-side como un panel.
            El script cliente solo muestra/oculta los paneles por `data-form`.
            Así podemos incluir componentes Astro (ej: <Prueba/>) dentro del panel `dev`.
        -->

        <div class="form-panel" data-form="basic">
            <Basic/>
        </div>

        <div class="form-panel hidden" data-form="gaming">
            <Gaming/>
        </div>

        <div class="form-panel hidden" data-form="monitor"></div>

        <div class="form-panel hidden" data-form="dev"></div>
        </div>
    </section>
</div>

<!-- SCRIPT FUNCIONAL -->
<script is:raw>
  // Ahora los formularios están renderizados server-side como paneles
  // con `data-form`. swapForm solo muestra/oculta los paneles.

  function swapForm(name) {
    const area = document.getElementById("form-area");
    if (!area) return;
    const panels = Array.from(area.querySelectorAll(".form-panel"));
    panels.forEach((p) => {
      if (p.dataset.form === name) {
        p.classList.remove("hidden");
      } else {
        p.classList.add("hidden");
      }
    });
  }

  // Manejo del estado activo en el aside (resalta la imagen seleccionada)
  (function () {
    const menu = document.getElementById("menu-botones");
    if (!menu) return;

    const buttons = Array.from(menu.querySelectorAll(".boton-formulario"));
    const initial = (localStorage.getItem("configSelected") || menu.dataset.selected || "basic").replace(/[{}]/g, '').trim();

    function setActive(targetBtn) {
      buttons.forEach((btn) => {
        btn.classList.remove("ring-4", "ring-gray-400", "bg-gray-100");
        const img = btn.querySelector("img");
        if (img) img.classList.remove("opacity-100");
      });

      if (!targetBtn) return;
      targetBtn.classList.add("ring-4", "ring-gray-400", "bg-gray-100");
      const img = targetBtn.querySelector("img");
      if (img) img.classList.add("opacity-100");
    }

    // Inicializar estado activo
    const initBtn =
      buttons.find((b) => b.dataset.form === initial) || buttons[0];
    setActive(initBtn);
    // Mostrar form inicial
    if (initBtn && initBtn.dataset && initBtn.dataset.form)
      swapForm(initBtn.dataset.form);

    // Añadir listeners a cada botón
    buttons.forEach((btn) => {
      btn.addEventListener("click", (e) => {
        const name = btn.dataset.form;
        setActive(btn);
        if (name) {
          swapForm(name);
          try { localStorage.setItem('configSelected', name); } catch (err) { /* ignore */ }
        }
      });
    });
  })();
</script>
