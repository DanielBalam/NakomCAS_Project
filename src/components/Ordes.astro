---
// Datos de ejemplo de pedidos
const pedidos = [
    {
        id: "0015",
        fecha: "21-11-2025",
        nombrePC: "Gamer Pro X1",
        precio: 25999,
        estado: "Preparando Componentes",
        componentes: [
            "CPU: Ryzen 7 5800X",
            "GPU: RTX 4070",
            "RAM: 16GB DDR4",
            "Almacenamiento: SSD 1TB NVMe",
            "Placa Madre: B550 Steel Legend",
            "Fuente: 750W 80+ Gold",
        ],
    },
    {
      id: "0014",
      fecha: "15-11-2025",
      nombrePC: "Ofimática Premium",
      precio: 12999,
      estado: "En Ensamblaje",
      componentes: [
            "CPU: Intel i5 12400",
            "GPU: Integrada UHD",
            "RAM: 16GB DDR4",
            "Almacenamiento: SSD 512GB",
            "Placa Madre: H610M",
            "Fuente: 500W 80+ Bronze"
      ]
    },
    {
        id: "0013",
        fecha: "10-11-2025",
        nombrePC: "Estación de Trabajo X2",
        precio: 34999,
        estado: "Envío en Proceso",
        componentes: [
            "CPU: Ryzen 9 5950X",
            "GPU: RTX 4090",
            "RAM: 64GB DDR4",
            "Almacenamiento: SSD 2TB NVMe + HDD 4TB",
            "Placa Madre: X570 Taichi",
            "Fuente: 1000W 80+ Platinum"
        ]
    }
];

// Pasar datos al cliente en formato seguro
const pedidosJSON = JSON.stringify(pedidos);
---

<div class="w-full flex flex-col gap-6" id="ordenesContainer"></div>

<script define:vars={{ pedidos }}>
  const container = document.getElementById("ordenesContainer");
  if (!container) {
    throw new Error("Contenedor de órdenes no encontrado");
  }

  let modalVisible = false;
  let pedidoSeleccionado = null;

  function abrirModal(pedido) {
    modalVisible = true;
    pedidoSeleccionado = pedido;
    renderizar();
  }

  function cerrarModal() {
    modalVisible = false;
    pedidoSeleccionado = null;
    renderizar();
  }

  function renderizar() {
    if (pedidos.length === 0) {
      container.innerHTML = `
        <div class="text-center text-gray-500">
          <p class="text-xl font-semibold">Aún no has realizado ningún pedido.</p>
          <a href="/Configuration" class="text-blue-600 underline hover:text-blue-800">
            Ir al configurador
          </a>
        </div>
      `;
      return;
    }

    let html = `
    <section class="w-full max-w-2xl mx-auto flex flex-col gap-4">
    <h1 class="text-3xl font-extrabold text-center text-gray-800 mt-3">
      Mis Pedidos
    </h1>

    ${pedidos.map((pedido) => `
        <button
          class="cursor-pointer p-6 bg-white rounded-2xl shadow-md transition-transform duration-200 text-left pedido-btn w-full m-3"
          data-id="${pedido.id}">
            <p class="font-bold text-lg text-gray-800">Pedido #${pedido.id}</p>
            <p class="text-sm text-gray-500">Fecha: ${pedido.fecha}</p>
            <p class="text-gray-700 font-semibold">PC: ${pedido.nombrePC}</p>
            <p class="text-gray-700 font-semibold">
              Precio Total: <span class="font-medium">$${pedido.precio}</span>
            </p>
            <p class="text-gray-700 font-semibold">
              Estado: <span class="text-blue-600">${pedido.estado}</span>
            </p>
        </button>
    `
      )
      .join("")}
    </section>
    `;

    if (modalVisible && pedidoSeleccionado) {
      html += `
        <div class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center p-4 z-50 transition-opacity duration-300 ease-out ${modalVisible ? "opacity-100" : "opacity-0"}">
            <div class="bg-white w-full max-w-lg rounded-2xl p-8 shadow-2xl relative transform transition-all duration-300 ease-out ${modalVisible ? "scale-100 opacity-100" : "scale-95 opacity-0"}">
                <h2 class="text-3xl font-extrabold mb-6 text-center text-gray-800">
                Detalles del Pedido
                </h2>
                <div class="space-y-2 text-gray-700">
                    <p><strong>Fecha:</strong> ${pedidoSeleccionado.fecha}</p>
                    <p><strong>PC:</strong> ${pedidoSeleccionado.nombrePC}</p>
                    <p><strong>Precio Total:</strong> $${pedidoSeleccionado.precio}</p>
                    <p><strong>Estado:</strong> ${pedidoSeleccionado.estado}</p>
                </div>
                <h3 class="mt-6 font-bold text-lg text-gray-800">Componentes:</h3>
                <ul class="list-disc ml-6 space-y-1 text-gray-600">
                ${pedidoSeleccionado.componentes.map((c) => `<li>${c}</li>`).join("")}
                </ul>

                <div class="mt-6 flex justify-center">
                  <button class="modal-close mt-4 bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 w-full cursor-pointer" type="button" aria-label="Cerrar modal" title="Cerrar">
                    Cerrar
                  </button>
                </div>
                <p class="mt-8 text-gray-500 text-sm text-center"> Para solicitudes de modificación o cancelación, visita la página de 
                    <a href="/Contact" class="text-blue-600 underline hover:text-blue-800">Contacto</a>.
                </p>
            </div>
        </div>
      `;
    }
    container.innerHTML = html;

    // Agregar event listeners después de renderizar
    document.querySelectorAll(".pedido-btn").forEach((btn) => {
      btn.addEventListener("click", () => {
        const id = btn.getAttribute("data-id");
        const pedido = pedidos.find((p) => p.id === id);
        if (pedido) abrirModal(pedido);
      });
    });

    const modalClose = document.querySelector(".modal-close");
    if (modalClose) {
      modalClose.addEventListener("click", cerrarModal);
    }
  }

  renderizar();
</script>

<style>
  button:focus {
    outline: none;
  }
</style>
